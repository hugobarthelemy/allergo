<h1>Add a product</h1>
<%= render 'form_add_product' %>

<% content_for :after_js do %>
  <script>
    $(document).ready(function() {
        var client = algoliasearch('<%= ENV['ALGOLIASEARCH_APPLICATION_ID'] %>', '<%= ENV['ALGOLIASEARCH_API_KEY_SEARCH'] %>');
        var template = Hogan.compile('<div class="hit-auto-complete">' +
            '<div class="fr_name">{{{_highlightResult.fr_name.value}}}</div>' +
            '<div class="en_name">{{{_highlightResult.en_name.value}}}</div>' + '<div class="ja_name">{{{_highlightResult.ja_name.value}}}</div>');
        var ac = autocomplete('#q', { hint: true }, {
          source: autocomplete.sources.hits(client.initIndex('<%= Ingredient.index_name %>'), { hitsPerPage: 5 }),
          displayKey: 'fr_name',
          templates: {
            suggestion: function(hit) {
              return template.render(hit);
            }
          }
        }).on('autocomplete:selected', function(event, suggestion) {
          console.log('onselected', suggestion);
          console.log(suggestion.fr_name);
          $("<p>" + suggestion.fr_name + suggestion.objectID+"</p>").appendTo('#ingredient-name');

            //TODO
            //Create a hidden field tag to send the id
            //Store the ids in an array to pass to create product
            //Add a remove button to remove ingredient from array and view
            //Think of non existing ingredients to add

        });
        $('.search-terms a').click(function(e) {
          ac.autocomplete.setVal($(this).text());
          ac.autocomplete.open();
          ac.focus();
        })


      });
  </script>
<% end %>


